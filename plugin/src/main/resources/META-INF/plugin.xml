<idea-plugin>
    <id>com.github.bric3.excalidraw</id>
    <name>Excalidraw Integration</name>
    <vendor>Brice Dutheil</vendor>

    <!-- Product and plugin compatibility requirements -->
    <!-- https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <fileType name="Excalidraw sketch"
                  implementationClass="com.github.bric3.excalidraw.files.ExcalidrawFileType"
                  fieldName="INSTANCE"
                  extensions="excalidraw;excalidraw.json"/>

        <lang.parserDefinition language="Excalidraw"
                               implementationClass="com.github.bric3.excalidraw.files.ExcalidrawJsonParserDefinition"/>
        <fileType name="Excalidraw SVG Export"
                  implementationClass="com.github.bric3.excalidraw.files.ExcalidrawSvgFileType"
                  fieldName="INSTANCE"
                  language="XML"
                  extensions="excalidraw.svg"/>
<!--        <fileType name="PNG with embedded Excalidraw metadata"-->
<!--                  implementationClass="com.github.bric3.excalidraw.files.ExcalidrawPngFileType"-->
<!--                  fieldName="INSTANCE"-->
<!--                  language="Excalidraw"-->
<!--                  extensions="excalidraw.png"-->
<!--                  />-->
        <iconProvider implementation="com.github.bric3.excalidraw.files.ExcalidrawIconProvider"/>

        <fileEditorProvider implementation="com.github.bric3.excalidraw.editor.ExcalidrawEditorProvider"/>

        <applicationService serviceImplementation="com.github.bric3.excalidraw.services.MyApplicationService"/>
        <projectService serviceImplementation="com.github.bric3.excalidraw.services.MyProjectService"/>

        <notificationGroup id="excalidraw.error" displayType="BALLOON" bundle="messages.MyBundle" key="title.excalidraw.usage.error"/>
    </extensions>

    <applicationListeners>
        <listener class="com.github.bric3.excalidraw.listeners.NoOpProjectManagerListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </applicationListeners>

    <actions>
        <!-- New File Menu -->
        <action id="excalidraw.NewFileAction"
                class="com.github.bric3.excalidraw.actions.ExcalidrawNewFileAction"/>

        <!-- Editor Toolbar -->
        <action id="excalidraw.ExportToSvgAction"
                class="com.github.bric3.excalidraw.actions.ExportToSvgAction"
                text="Export to SVG"
                description="Export current Excalidraw drawing to SVG"
                icon="ExcalidrawIcons.SaveAsSvg"/>
        <action id="excalidraw.ExportToPngAction"
                class="com.github.bric3.excalidraw.actions.ExportToPngAction"
                text="Export to PNG"
                description="Export current Excalidraw drawing to PNG"
                icon="ExcalidrawIcons.SaveAsPng"/>

        <!-- Groups -->
        <group id="excalidraw.ExcalidrawNewActionGroup" text="Excalidraw">
            <reference id="excalidraw.NewFileAction" />
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFromTemplate"/>
        </group>
        <group id="excalidraw.ToolbarActionGroup">
            <!-- TODO Save option toggles: exportBackground, shouldAddWatermark, exportWithDarkMode -->
            <reference ref="excalidraw.ExportToSvgAction"/>
            <reference ref="excalidraw.ExportToPngAction"/>
            <separator/>
            <!-- Scene options : grid, zen -->
        </group>

    </actions>


</idea-plugin>